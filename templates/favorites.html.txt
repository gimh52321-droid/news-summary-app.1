<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ë‹¨ì–´ì¥</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f7f8fa; }
h1{text-align:center; margin-bottom:20px;}
.word-card { background:white; padding:10px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc; position:relative; }
.del-btn { position:absolute; right:10px; top:10px; color:red; cursor:pointer; font-weight:bold; }
.word-title { font-weight:bold; font-size:16px; margin-bottom:4px; cursor:pointer; color:#0b66ff; text-decoration:underline; }
.meaning { font-size:14px; color:#555; margin-bottom:2px; }
a.back{display:block; text-align:center; margin-top:20px;}
</style>
</head>
<body>
<h1>ğŸ“˜ ë‹¨ì–´ì¥</h1>
{% if wordbook %}
    {% for w in wordbook %}
        <div class="word-card" data-word="{{ w.word }}">
            <span class="word-title" onclick="openPopup('{{ w.word|e }}')">{{ w.word }}</span>
            <span class="del-btn" onclick="deleteWord('{{ w.word|e }}')">Ã—</span>
            <div>
                {% for m in w.meanings %}
                    <div class="meaning">â€¢ {{ m }}</div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
{% else %}
<p style="text-align:center;">ë‹¨ì–´ì¥ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.</p>
{% endif %}
<a href="/" class="back">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

<!-- íŒì—… -->
<div id="popup" style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:420px; max-height:70vh; overflow:auto; background:white; padding:16px; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.2); z-index:9999;">
<span style="float:right; cursor:pointer; color:#999;" onclick="closePopup()">âœ•</span>
<h3 id="popup-word"></h3>
<div id="popup-meanings"></div>
<div style="margin-top:12px;">
<button id="save-word-btn" onclick="">ë‹¨ì–´ì¥ì— ì €ì¥</button>
</div>
</div>

<script>
let lastFetchedWord="", lastFetchedMeanings=[];
async function openPopup(word){
    lastFetchedWord = word;
    try{
        const res = await fetch(`/api/define?word=${encodeURIComponent(word)}`);
        const data = await res.json();
        lastFetchedMeanings = data.meanings || ["ëœ»ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."];
        document.getElementById("popup-word").innerText = word;
        const container = document.getElementById("popup-meanings");
        container.innerHTML="";
        lastFetchedMeanings.forEach((m,i)=>{
            const div=document.createElement("div"); div.style.marginBottom="6px";
            div.innerHTML=`<strong>${i+1}.</strong> ${m}`; container.appendChild(div);
        });
        document.getElementById("save-word-btn").onclick = saveLastWord;
        document.getElementById("popup").style.display="block";
    }catch(e){alert("ëœ»ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜");}
}
function closePopup(){document.getElementById("popup").style.display="none";}
async function saveLastWord(){
    if(!lastFetchedWord) return;
    try{
        const res = await fetch("/add_word", {
            method:"POST", headers:{"Content-Type":"application/json"},
            body:JSON.stringify({word:lastFetchedWord, meanings:lastFetchedMeanings})
        });
        const data = await res.json();
        if(data.success){alert("ë‹¨ì–´ì¥ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); closePopup();}
        else alert(data.error||"ì €ì¥ ì‹¤íŒ¨");
    }catch(e){alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜");}
}
async function deleteWord(word){
    if(!confirm(word+"ì„(ë¥¼) ì‚­ì œí• ê¹Œìš”?")) return;
    try{
        const res = await fetch("/delete_word", {
            method:"POST", headers:{"Content-Type":"application/json"},
            body:JSON.stringify({word:word})
        });
        const data = await res.json();
        if(data.success) location.reload();
        else alert("ì‚­ì œ ì‹¤íŒ¨");
    }catch(e){alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜");}
}
</script>
</body>
</html>
