<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>뉴스 요약 + 단어장</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f9f9f9; }
.top-menu { margin-bottom:20px; }
.top-menu a { margin-right:15px; text-decoration:none; color:#2b6cdf; font-weight:bold; }
.search-box { margin-bottom:20px; }
.search-box input { padding:6px 10px; margin-right:5px; }
.search-box button { padding:6px 10px; }
.meanings-box { margin-bottom:20px; background:#eaf3ff; padding:12px; border-radius:6px; display:none; }
.news-card { background:white; padding:14px; border-radius:8px; margin-bottom:16px; box-shadow:0 3px 8px rgba(0,0,0,0.08); border-left:5px solid #2b6cdf; position:relative; }
.news-number { font-weight:bold; margin-bottom:4px; }
.news-title { font-size:20px; font-weight:bold; margin-bottom:6px; color:#1a1a1a; }
.news-summary { color:#333; line-height:1.6; margin-bottom:6px; }
.fav-btn { position:absolute; right:12px; top:12px; cursor:pointer; font-size:18px; color:gold; text-decoration:none; }
</style>
</head>
<body>

<div class="top-menu">
    <a href="/">홈</a>
    <a href="/favorites">즐겨찾기</a>
    <a href="/wordbook">단어장</a>
</div>

<div class="search-box">
    <input type="text" id="news-search" placeholder="뉴스 검색">
    <button onclick="searchNews()">검색</button>
    <br><br>
    <input type="text" id="word-search" placeholder="단어 검색">
    <button onclick="searchWord()">뜻 검색 & 단어장 저장</button>
</div>

<div id="meanings-box" class="meanings-box"></div>

{% for cat, articles in news_data.items() %}
<h2>{{ cat }}</h2>
{% for a in articles %}
<div class="news-card">
    <div class="news-number">{{ a.id }}.</div>
    {% if a.title in favorites %}
        <a class="fav-btn" href="/unfavorite/{{ a.title|urlencode }}">★</a>
    {% else %}
        <a class="fav-btn" href="/favorite/{{ a.title|urlencode }}">☆</a>
    {% endif %}
    <div class="news-title">{{ a.title }}</div>
    <div class="news-summary">{{ a.summary }}</div>
    <div><a href="{{ a.link }}" target="_blank">원문 보기</a></div>
</div>
{% endfor %}
{% endfor %}

<script>
function searchNews() {
    const query = document.getElementById("news-search").value.trim();
    if(!query) return location.href="/";
    window.location.href = "/?query=" + encodeURIComponent(query);
}

let lastFetchedWord = "";
let lastFetchedMeanings = [];

async function searchWord() {
    const word = document.getElementById("word-search").value.trim();
    if(!word) return;

    try {
        const res = await fetch(`/api/define?word=${encodeURIComponent(word)}`);
        const data = await res.json();
        lastFetchedMeanings = data.meanings || ["뜻을 찾을 수 없습니다."];
        lastFetchedWord = word;

        const box = document.getElementById("meanings-box");
        box.style.display = "block";
        box.innerHTML = `<strong>${word}</strong><br>` + lastFetchedMeanings.map((m,i)=>`${i+1}. ${m}`).join("<br>");

        await fetch("/add_word", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({word:lastFetchedWord, meanings:lastFetchedMeanings})
        });
    } catch(e){
        alert("단어 검색 중 오류가 발생했습니다.");
    }
}
</script>
</body>
</html>
